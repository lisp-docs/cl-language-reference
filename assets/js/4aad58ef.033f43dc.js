"use strict";(self.webpackChunkcl_language_reference=self.webpackChunkcl_language_reference||[]).push([[46653],{60132:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var o=t(85893),n=t(11151);const r={},i="The defclass macro",c={id:"meta-object-protocol/the-defclass-macro",title:"The defclass macro",description:"The defclass macro",source:"@site/docs/meta-object-protocol/the-defclass-macro.md",sourceDirName:"meta-object-protocol",slug:"/meta-object-protocol/the-defclass-macro",permalink:"/cl-language-reference/meta-object-protocol/the-defclass-macro",draft:!1,unlisted:!1,editUrl:"https://github.com/lisp-docs/cl-language-reference/tree/main/docs/meta-object-protocol/the-defclass-macro.md",tags:[],version:"current",lastUpdatedBy:"Daniel Nussenbaum",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Table of contents",permalink:"/cl-language-reference/meta-object-protocol/table-of-contents"},next:{title:"The defgeneric macro",permalink:"/cl-language-reference/meta-object-protocol/the-defgeneric-macro"}},a={},l=[{value:"The <code>defclass</code> macro",id:"the-defclass-macro-1",level:3}];function h(e){const s={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",hr:"hr",li:"li",p:"p",ul:"ul",...(0,n.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.h1,{id:"the-defclass-macro",children:"The defclass macro"}),"\n",(0,o.jsxs)(s.h3,{id:"the-defclass-macro-1",children:["The ",(0,o.jsx)(s.code,{children:"defclass"})," macro"]}),"\n",(0,o.jsxs)(s.p,{children:["The evaluation or execution of a ",(0,o.jsx)(s.code,{children:"defclass"})," form results in a call to the ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," function. The arguments received by ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," are derived from the ",(0,o.jsx)(s.code,{children:"defclass"})," form in a defined way. The exact macro-expansion of the ",(0,o.jsx)(s.code,{children:"defclass"})," form is not defined, only the relationship between the arguments to the ",(0,o.jsx)(s.code,{children:"defclass"})," macro and the arguments received by the ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," function. Examples of typical ",(0,o.jsx)(s.code,{children:"defclass"})," forms and sample expansions are shown in the Figures below."]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsxs)(s.p,{children:["(defclass plane (moving-object graphics-object)\n((altitude ",":initform"," 0 ",":accessor"," plane-altitude)\n(speed))\n(",":default-initargs"," ",":engine"," ",(0,o.jsx)(s.em,{children:"jet"}),"))"]}),"\n",(0,o.jsxs)(s.p,{children:["(ensure-class 'plane\n'",":direct-superclasses"," '(moving-object graphics-object)\n'",":direct-slots"," (list (list '",":name"," 'altitude\n'",":initform"," '0\n'",":initfunction"," #'(lambda () 0)\n'",":readers"," '(plane-altitude)\n'",":writers"," '((setf plane-altitude)))\n(list '",":name"," 'speed))\n'",":direct-default-initargs"," (list (list '",":engine","\n'",(0,o.jsx)(s.em,{children:"jet"}),"\n#'(lambda () ",(0,o.jsx)(s.em,{children:"jet"}),"))))"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsxs)(s.p,{children:["A ",(0,o.jsx)(s.code,{children:"defclass"})," form with standard slot and class options and an expansion of it that would result in the proper call to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"."]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsxs)(s.p,{children:["(defclass sst (plane)\n((mach mag-step 2\nlocator sst-mach\nlocator mach-location\n",":reader"," mach-speed\n",":reader"," mach))\n(",":metaclass"," faster-class)\n(another-option foo bar))"]}),"\n",(0,o.jsxs)(s.p,{children:["(ensure-class 'sst\n'",":direct-superclasses"," '(plane)\n'",":direct-slots"," (list (list '",":name"," 'mach\n'",":readers"," '(mach-speed mach)\n'mag-step '2\n'locator '(sst-mach mach-location)))\n'",":metaclass"," 'faster-class\n'another-option '(foo bar))"]}),"\n",(0,o.jsx)(s.hr,{}),"\n",(0,o.jsxs)(s.p,{children:["A ",(0,o.jsx)(s.code,{children:"defclass"})," form with non-standard class and slot options, and an expansion of it which results in the proper call to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),". Note that the order of the slot options has not affected the order of the properties in the canonicalized slot specification, but has affected the order of the elements in the lists which are the values of those properties."]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"name"})," argument to ",(0,o.jsx)(s.code,{children:"defclass"})," becomes the value of the first argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),". This is the only positional argument accepted by ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"; all other arguments are keyword arguments."]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"direct-superclasses"})," argument to ",(0,o.jsx)(s.code,{children:"defclass"})," becomes the value of the ",(0,o.jsx)(s.code,{children:":direct-super-classes"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"direct slots"})," argument to ",(0,o.jsx)(s.code,{children:"defclass"})," becomes the value of the ",(0,o.jsx)(s.code,{children:":direct-slots"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),". Special processing of this value is done to regularize the form of each slot specification and to properly capture the lexical scope of the initialization forms. This is done by converting each slot specification to a property list called a ",(0,o.jsx)(s.em,{children:"canonicalized slot specification"}),". The resulting list of canonicalized slot specifications is the value of the ",(0,o.jsx)(s.code,{children:":direct-slots"})," keyword argument."]}),"\n",(0,o.jsxs)(s.p,{children:["Canonicalized slot specifications are later used as the keyword arguments to a generic function which will, in turn, pass them to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/make-instance",children:"make-instance"})," for use as a set of initialization arguments. Each canonicalized slot specification is formed from the corresponding slot specification as follows:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["The name of the slot is the value of the ",(0,o.jsx)(s.code,{children:":name"})," property. This property appears in every canonicalized slot specification."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["When the ",(0,o.jsx)(s.code,{children:":initform"})," slot option is present in the slot specification, then both the ",(0,o.jsx)(s.code,{children:":initform"})," and ",(0,o.jsx)(s.code,{children:":initfunction"})," properties are present in the canonicalized slot specification. The value of the ",(0,o.jsx)(s.code,{children:":initform"})," property is the initialization form. The value of the ",(0,o.jsx)(s.code,{children:":initfunction"})," property is a function of zero arguments which, when called, returns the result of evaluating the initialization form in its proper lexical environment."]}),"\n",(0,o.jsxs)(s.p,{children:["If the ",(0,o.jsx)(s.code,{children:":initform"})," slot option is not present in the slot specification, then either the ",(0,o.jsx)(s.code,{children:":initfunction"})," property will not appear, or its value will be false. In such cases, the value of the ",(0,o.jsx)(s.code,{children:":initform"})," property, or whether it appears, is unspecified."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["The value of the ",(0,o.jsx)(s.code,{children:":initargs"})," property is a list of the values of each ",(0,o.jsx)(s.code,{children:":initarg"})," slot option. If there are no ",(0,o.jsx)(s.code,{children:":initarg"})," slot options, then either the ",(0,o.jsx)(s.code,{children:":initargs"})," property will not appear or its value will be the empty list."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["The value of the ",(0,o.jsx)(s.code,{children:":readers"})," property is a list of the values of each ",(0,o.jsx)(s.code,{children:":reader"})," and ",(0,o.jsx)(s.code,{children:":accessor"})," slot option. If there are no ",(0,o.jsx)(s.code,{children:":reader"})," or ",(0,o.jsx)(s.code,{children:":accessor"})," slot options, then either the ",(0,o.jsx)(s.code,{children:":readers"})," property will not appear or its value will be the empty list."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["The value of the ",(0,o.jsx)(s.code,{children:":writers"})," property is a list of the values specified by each ",(0,o.jsx)(s.code,{children:":writer"})," and ",(0,o.jsx)(s.code,{children:":accessor"})," slot option. The value specified by a ",(0,o.jsx)(s.code,{children:":writer"})," slot option is just the value of the slot option. The value specified by an ",(0,o.jsx)(s.code,{children:":accessor"})," slot option is a two element list: the first element is the symbol ",(0,o.jsx)(s.code,{children:"setf"}),", the second element is the value of the slot option. If there are no ",(0,o.jsx)(s.code,{children:":writer"})," or ",(0,o.jsx)(s.code,{children:":accessor"})," slot options, then either the ",(0,o.jsx)(s.code,{children:":writers"})," property will not appear or its value will be the empty list."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["The value of the ",(0,o.jsx)(s.code,{children:":documentation"})," property is the value of the ",(0,o.jsx)(s.code,{children:":documentation"})," slot option. If there is no ",(0,o.jsx)(s.code,{children:":documentation"})," slot option, then either the ",(0,o.jsx)(s.code,{children:":documentation"})," property will not appear or its value will be false."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["All other slot options appear as the values of properties with the same name as the slot option. Note that this includes not only the remaining standard slot options (",(0,o.jsx)(s.code,{children:":allocation"})," and ",(0,o.jsx)(s.code,{children:":type"}),"), but also any other options and values appearing in the slot specification. If one of these slot options appears more than once, the value of the property will be a list of the specified values."]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:["An implementation is free to add additional properties to the canonicalized slot specification provided these are not symbols accessible in the ",(0,o.jsx)(s.code,{children:"common-lisp-user"})," package, or exported by any package defined in the ANSI Common Lisp standard."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["Returning to the correspondence between arguments to the ",(0,o.jsx)(s.code,{children:"defclass"})," macro and the arguments received by the ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," function:"]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"default initargs"})," class option, if it is present in the ",(0,o.jsx)(s.code,{children:"defclass"})," form, becomes the value of the ",(0,o.jsx)(s.code,{children:":direct-default-initargs"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),". Special processing of this value is done to properly capture the lexical scope of the default value forms. This is done by converting each default initarg in the class option into a ",(0,o.jsx)(s.em,{children:"canonicalized default initarg"}),". The resulting list of canonicalized default initargs is the value of the ",(0,o.jsx)(s.code,{children:":direct-default-initargs"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"A canonicalized default initarg is a list of three elements. The first element is the name; the second is the actual form itself; and the third is a function of zero arguments which, when called, returns the result of evaluating the default value form in its proper lexical environment."}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"metaclass"})," class option, if it is present in the ",(0,o.jsx)(s.code,{children:"defclass"})," form, becomes the value of the ",(0,o.jsx)(s.code,{children:":metaclass"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.em,{children:"documentation"})," class option, if it is present in the ",(0,o.jsx)(s.code,{children:"defclass"})," form, becomes the value of the ",(0,o.jsx)(s.code,{children:":documentation"})," keyword argument to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Any other class options become the value of keyword arguments with the same name. The value of the keyword argument is the tail of the class option. An error is signaled if any class option appears more than once in the ",(0,o.jsx)(s.code,{children:"defclass"})," form."]}),"\n",(0,o.jsxs)(s.p,{children:["In the call to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"}),", every element of its arguments appears in the same left-to-right order as the corresponding element of the ",(0,o.jsx)(s.code,{children:"defclass"})," form, except that the order of the properties of canonicalized slot specifications is unspecified. The values of properties in canonicalized slot specifications do follow this ordering requirement. Other ordering relationships in the keyword arguments to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," are unspecified."]}),"\n",(0,o.jsxs)(s.p,{children:["The result of the call to ",(0,o.jsx)(s.a,{href:"/meta-object-protocol/ensure-class",children:"ensure-class"})," is returned as the result of evaluating or executing the ",(0,o.jsx)(s.code,{children:"defclass"})," form."]})]})}function d(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},11151:(e,s,t)=>{t.d(s,{Z:()=>c,a:()=>i});var o=t(67294);const n={},r=o.createContext(n);function i(e){const s=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),o.createElement(r.Provider,{value:s},e.children)}}}]);